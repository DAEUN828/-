<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™í‚¤ì½© - ì „ìì˜¤ë½ì‹¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(180deg, #0f0c29, #302b63, #24243e);
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 850px;
        }
        
        #loginScreen, #gameScreen, #gameOverScreen {
            text-align: center;
        }
        
        #loginScreen {
            background: #1a1a2e;
            padding: 40px;
            border-radius: 15px;
            border: 4px solid #ff6b6b;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
        }
        
        #loginScreen h1 {
            color: #ff6b6b;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 4px 4px #000;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        #loginScreen input {
            display: block;
            width: 100%;
            max-width: 350px;
            padding: 15px;
            margin: 15px auto;
            font-size: 18px;
            border: 2px solid #ff6b6b;
            background: #000;
            color: #fff;
            border-radius: 5px;
        }
        
        #loginScreen input:focus {
            outline: none;
            border-color: #ffd93d;
        }
        
        button {
            padding: 15px 50px;
            font-size: 20px;
            background: #ff6b6b;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        
        #gameScreen {
            display: none;
        }
        
        #gameInfo {
            background: #1a1a2e;
            padding: 15px;
            margin-bottom: 10px;
            border: 3px solid #ff6b6b;
            border-radius: 8px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        #gameInfo div {
            margin: 5px 10px;
            font-size: 18px;
            color: #ffd93d;
            font-weight: bold;
        }
        
        canvas {
            border: 4px solid #ff6b6b;
            background: #000;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }
        
        #controls {
            margin-top: 15px;
            padding: 10px;
            font-size: 16px;
            color: #ffd93d;
            background: #1a1a2e;
            border-radius: 5px;
        }
        
        #leaderboard {
            margin-top: 20px;
            background: #1a1a2e;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #ffd93d;
        }
        
        #leaderboard h2 {
            color: #ffd93d;
            margin-bottom: 15px;
        }
        
        #leaderboardList {
            list-style: none;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }
        
        #leaderboardList li {
            padding: 10px;
            margin: 5px 0;
            background: #000;
            border-left: 4px solid #ff6b6b;
            border-radius: 3px;
        }
        
        #leaderboardList li.top3 {
            border-left-color: #ffd93d;
            font-weight: bold;
        }
        
        #gameOverScreen {
            display: none;
            background: #1a1a2e;
            padding: 40px;
            border-radius: 15px;
            border: 4px solid #ff6b6b;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
        }
        
        #gameOverScreen h2 {
            color: #ff6b6b;
            font-size: 42px;
            margin-bottom: 20px;
        }
        
        #finalScore {
            font-size: 32px;
            color: #ffd93d;
            margin: 20px 0;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loginScreen">
            <h1>ğŸ¦ DONKEY KONG ğŸ¦</h1>
            <p style="color: #ffd93d; margin-bottom: 20px;">1990ë…„ëŒ€ ì „ìì˜¤ë½ì‹¤ì˜ ì „ì„¤</p>
            <input type="text" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
            <input type="text" id="studentIdInput" placeholder="í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
            <button onclick="login()">ê²Œì„ ì‹œì‘</button>
            
            <div id="leaderboard">
                <h2>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ†</h2>
                <ul id="leaderboardList">
                    <li>ë¡œë”© ì¤‘...</li>
                </ul>
            </div>
        </div>
        
        <div id="gameScreen">
            <div id="gameInfo">
                <div>ğŸ‘¤ <span id="playerName"></span></div>
                <div>ğŸ“ <span id="playerId"></span></div>
                <div>â­ ì ìˆ˜: <span id="score">0</span></div>
                <div>â¤ï¸ ìƒëª…: <span id="lives">3</span></div>
                <div>ğŸ¯ ë ˆë²¨: <span id="level">1</span></div>
            </div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            <div id="controls">
                â¬…ï¸ ì™¼ìª½: A í‚¤ | â¡ï¸ ì˜¤ë¥¸ìª½: D í‚¤ | â¬†ï¸ ì í”„: W í‚¤ ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”
            </div>
        </div>
        
        <div id="gameOverScreen">
            <h2>ê²Œì„ ì˜¤ë²„!</h2>
            <div id="finalScore"></div>
            <p style="color: #ffd93d; margin: 20px 0;">ìˆœìœ„í‘œì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            <button onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
            <button onclick="goToLogin()" style="background: #6c5ce7;">ë©”ì¸ìœ¼ë¡œ</button>
        </div>
    </div>

    <script type="module">
        // Firebase ì„¤ì • (ì—¬ê¸°ì— ë³¸ì¸ì˜ Firebase ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”)
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, push, onValue, query, orderByChild, limitToLast } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // TODO: ì—¬ê¸°ì— ë³¸ì¸ì˜ Firebase ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "AIzaSyCADm2B-x4tg48P6DEJxJhb2MYWFFD1oTU",
  authDomain: "donkeykong-b1c93.firebaseapp.com",
  databaseURL: "https://donkeykong-b1c93-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "donkeykong-b1c93",
  storageBucket: "donkeykong-b1c93.firebasestorage.app",
  messagingSenderId: "553647618000",
  appId: "1:553647618000:web:281d505c6dc946a379ebd5",
  measurementId: "G-M8GWP77765"
};
        
        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // ì „ì—­ ë³€ìˆ˜
        window.playerName = '';
        window.studentId = '';
        window.gameScore = 0;
        
        // ë¡œê·¸ì¸ í•¨ìˆ˜
        window.login = function() {
            const name = document.getElementById('nameInput').value.trim();
            const id = document.getElementById('studentIdInput').value.trim();
            
            if (!name || !id) {
                alert('ì´ë¦„ê³¼ í•™ë²ˆì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            window.playerName = name;
            window.studentId = id;
            
            document.getElementById('playerName').textContent = name;
            document.getElementById('playerId').textContent = id;
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            initGame();
        };
        
        // ìˆœìœ„í‘œ ë¡œë“œ
        function loadLeaderboard() {
            const leaderboardRef = ref(database, 'leaderboard');
            const topScoresQuery = query(leaderboardRef, orderByChild('score'), limitToLast(10));
            
            onValue(topScoresQuery, (snapshot) => {
                const leaderboardList = document.getElementById('leaderboardList');
                leaderboardList.innerHTML = '';
                
                const scores = [];
                snapshot.forEach((childSnapshot) => {
                    scores.push(childSnapshot.val());
                });
                
                scores.reverse();
                
                if (scores.length === 0) {
                    leaderboardList.innerHTML = '<li>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</li>';
                    return;
                }
                
                scores.forEach((data, index) => {
                    const li = document.createElement('li');
                    li.className = index < 3 ? 'top3' : '';
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}.`;
                    li.textContent = `${medal} ${data.name} (${data.studentId}) - ${data.score}ì `;
                    leaderboardList.appendChild(li);
                });
            });
        }
        
        // ì ìˆ˜ ì €ì¥
        window.saveScore = function(score) {
            const leaderboardRef = ref(database, 'leaderboard');
            const newScoreRef = push(leaderboardRef);
            
            set(newScoreRef, {
                name: window.playerName,
                studentId: window.studentId,
                score: score,
                timestamp: Date.now()
            });
        };
        
        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            let score = 0;
            let lives = 3;
            let level = 1;
            let gameRunning = true;
            
            // í”Œë ˆì´ì–´
            const player = {
                x: 50,
                y: 500,
                width: 30,
                height: 40,
                speed: 5,
                jumpPower: 15,
                velocityY: 0,
                isJumping: false,
                color: '#ff6b6b'
            };
            
            // í”Œë«í¼ë“¤
            const platforms = [
                { x: 0, y: 560, width: 800, height: 40 },
                { x: 100, y: 450, width: 600, height: 20 },
                { x: 50, y: 340, width: 600, height: 20 },
                { x: 150, y: 230, width: 600, height: 20 },
                { x: 50, y: 120, width: 300, height: 20 }
            ];
            
            // í”„ë¦°ì„¸ìŠ¤
            const princess = {
                x: 100,
                y: 70,
                width: 25,
                height: 35,
                color: '#ffd93d'
            };
            
            // ë™í‚¤ì½©
            const donkeyKong = {
                x: 700,
                y: 70,
                width: 50,
                height: 50,
                color: '#8B4513'
            };
            
            // ë°°ëŸ´ë“¤
            let barrels = [];
            let barrelTimer = 0;
            
            // í‚¤ ì…ë ¥
            const keys = {};
            window.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                if ((e.key === 'w' || e.key === 'W' || e.key === ' ') && !player.isJumping) {
                    player.velocityY = -player.jumpPower;
                    player.isJumping = true;
                }
            });
            
            window.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            // ë°°ëŸ´ ìƒì„±
            function createBarrel() {
                barrels.push({
                    x: donkeyKong.x,
                    y: donkeyKong.y + 50,
                    width: 20,
                    height: 20,
                    speed: 2 + level * 0.5,
                    velocityY: 0
                });
            }
            
            // ì¶©ëŒ ê°ì§€
            function checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }
            
            // ê²Œì„ ì—…ë°ì´íŠ¸
            function update() {
                if (!gameRunning) return;
                
                // í”Œë ˆì´ì–´ ì´ë™
                if (keys['a']) player.x -= player.speed;
                if (keys['d']) player.x += player.speed;
                
                // ê²½ê³„ ì²´í¬
                player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
                
                // ì¤‘ë ¥
                player.velocityY += 0.8;
                player.y += player.velocityY;
                
                // í”Œë«í¼ ì¶©ëŒ
                player.isJumping = true;
                platforms.forEach(platform => {
                    if (player.velocityY > 0 &&
                        player.x + player.width > platform.x &&
                        player.x < platform.x + platform.width &&
                        player.y + player.height > platform.y &&
                        player.y + player.height < platform.y + platform.height) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.isJumping = false;
                    }
                });
                
                // ë°°ëŸ´ ìƒì„±
                barrelTimer++;
                if (barrelTimer > 60 - level * 5) {
                    createBarrel();
                    barrelTimer = 0;
                }
                
                // ë°°ëŸ´ ì—…ë°ì´íŠ¸
                barrels.forEach((barrel, index) => {
                    barrel.x -= barrel.speed;
                    barrel.velocityY += 0.8;
                    barrel.y += barrel.velocityY;
                    
                    // ë°°ëŸ´ í”Œë«í¼ ì¶©ëŒ
                    platforms.forEach(platform => {
                        if (barrel.velocityY > 0 &&
                            barrel.x + barrel.width > platform.x &&
                            barrel.x < platform.x + platform.width &&
                            barrel.y + barrel.height > platform.y &&
                            barrel.y < platform.y + platform.height) {
                            barrel.y = platform.y - barrel.height;
                            barrel.velocityY = 0;
                        }
                    });
                    
                    // í”Œë ˆì´ì–´-ë°°ëŸ´ ì¶©ëŒ
                    if (checkCollision(player, barrel)) {
                        lives--;
                        barrels.splice(index, 1);
                        document.getElementById('lives').textContent = lives;
                        
                        if (lives <= 0) {
                            gameOver();
                        } else {
                            player.x = 50;
                            player.y = 500;
                        }
                    }
                    
                    // í™”ë©´ ë°– ë°°ëŸ´ ì œê±°
                    if (barrel.x < -50 || barrel.y > canvas.height) {
                        barrels.splice(index, 1);
                        score += 10;
                        document.getElementById('score').textContent = score;
                    }
                });
                
                // í”„ë¦°ì„¸ìŠ¤ ë„ë‹¬
                if (checkCollision(player, princess)) {
                    score += 1000;
                    level++;
                    document.getElementById('score').textContent = score;
                    document.getElementById('level').textContent = level;
                    player.x = 50;
                    player.y = 500;
                    barrels = [];
                }
            }
            
            // ê²Œì„ ê·¸ë¦¬ê¸°
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // í”Œë«í¼
                ctx.fillStyle = '#00d2ff';
                platforms.forEach(platform => {
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                });
                
                // ë™í‚¤ì½©
                ctx.fillStyle = donkeyKong.color;
                ctx.fillRect(donkeyKong.x, donkeyKong.y, donkeyKong.width, donkeyKong.height);
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText('ğŸ¦', donkeyKong.x + 15, donkeyKong.y + 30);
                
                // í”„ë¦°ì„¸ìŠ¤
                ctx.fillStyle = princess.color;
                ctx.fillRect(princess.x, princess.y, princess.width, princess.height);
                ctx.fillText('ğŸ‘¸', princess.x + 5, princess.y + 25);
                
                // í”Œë ˆì´ì–´
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);
                ctx.fillText('ğŸ§‘', player.x + 5, player.y + 25);
                
                // ë°°ëŸ´
                ctx.fillStyle = '#8B4513';
                barrels.forEach(barrel => {
                    ctx.fillRect(barrel.x, barrel.y, barrel.width, barrel.height);
                });
            }
            
            // ê²Œì„ ì˜¤ë²„
            function gameOver() {
                gameRunning = false;
                window.gameScore = score;
                window.saveScore(score);
                
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.remove('hidden');
                document.getElementById('finalScore').textContent = `ìµœì¢… ì ìˆ˜: ${score}ì `;
            }
            
            // ê²Œì„ ë£¨í”„
            function gameLoop() {
                update();
                draw();
                if (gameRunning) {
                    requestAnimationFrame(gameLoop);
                }
            }
            
            gameLoop();
        }
        
        // ì¬ì‹œì‘
        window.restartGame = function() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('score').textContent = '0';
            document.getElementById('lives').textContent = '3';
            document.getElementById('level').textContent = '1';
            initGame();
        };
        
        // ë©”ì¸ìœ¼ë¡œ
        window.goToLogin = function() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            loadLeaderboard();
        };
        
        // ì´ˆê¸° ìˆœìœ„í‘œ ë¡œë“œ
        loadLeaderboard();
    </script>
</body>
</html>